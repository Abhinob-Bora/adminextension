/*! For license information please see background.bundle.js.LICENSE.txt */
(()=>{"use strict";var e,t="Hello, ".concat("World","!");function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function r(){r=function(){return t};var e,t={},o=Object.prototype,a=o.hasOwnProperty,c=Object.defineProperty||function(e,t,n){e[t]=n.value},s="function"==typeof Symbol?Symbol:{},i=s.iterator||"@@iterator",u=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function p(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(e){p=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var o=t&&t.prototype instanceof v?t:v,a=Object.create(o.prototype),s=new M(r||[]);return c(a,"_invoke",{value:S(e,n,s)}),a}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}t.wrap=h;var d="suspendedStart",g="suspendedYield",m="executing",y="completed",b={};function v(){}function w(){}function x(){}var k={};p(k,i,(function(){return this}));var _=Object.getPrototypeOf,T=_&&_(_(N([])));T&&T!==o&&a.call(T,i)&&(k=T);var j=x.prototype=v.prototype=Object.create(k);function E(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function O(e,t){function r(o,c,s,i){var u=f(e[o],e,c);if("throw"!==u.type){var l=u.arg,p=l.value;return p&&"object"==n(p)&&a.call(p,"__await")?t.resolve(p.__await).then((function(e){r("next",e,s,i)}),(function(e){r("throw",e,s,i)})):t.resolve(p).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,i)}))}i(u.arg)}var o;c(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,o){r(e,n,t,o)}))}return o=o?o.then(a,a):a()}})}function S(t,n,r){var o=d;return function(a,c){if(o===m)throw Error("Generator is already running");if(o===y){if("throw"===a)throw c;return{value:e,done:!0}}for(r.method=a,r.arg=c;;){var s=r.delegate;if(s){var i=L(s,r);if(i){if(i===b)continue;return i}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=y,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=m;var u=f(t,n,r);if("normal"===u.type){if(o=r.done?y:g,u.arg===b)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=y,r.method="throw",r.arg=u.arg)}}}function L(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,L(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),b;var a=f(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,b;var c=a.arg;return c?c.done?(n[t.resultName]=c.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,b):c:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,b)}function D(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(D,this),this.reset(!0)}function N(t){if(t||""===t){var r=t[i];if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var o=-1,c=function n(){for(;++o<t.length;)if(a.call(t,o))return n.value=t[o],n.done=!1,n;return n.value=e,n.done=!0,n};return c.next=c}}throw new TypeError(n(t)+" is not iterable")}return w.prototype=x,c(j,"constructor",{value:x,configurable:!0}),c(x,"constructor",{value:w,configurable:!0}),w.displayName=p(x,l,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,p(e,l,"GeneratorFunction")),e.prototype=Object.create(j),e},t.awrap=function(e){return{__await:e}},E(O.prototype),p(O.prototype,u,(function(){return this})),t.AsyncIterator=O,t.async=function(e,n,r,o,a){void 0===a&&(a=Promise);var c=new O(h(e,n,r,o),a);return t.isGeneratorFunction(n)?c:c.next().then((function(e){return e.done?e.value:c.next()}))},E(j),p(j,l,"Generator"),p(j,i,(function(){return this})),p(j,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},t.values=N,M.prototype={constructor:M,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(I),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return s.type="throw",s.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var c=this.tryEntries[o],s=c.completion;if("root"===c.tryLoc)return r("end");if(c.tryLoc<=this.prev){var i=a.call(c,"catchLoc"),u=a.call(c,"finallyLoc");if(i&&u){if(this.prev<c.catchLoc)return r(c.catchLoc,!0);if(this.prev<c.finallyLoc)return r(c.finallyLoc)}else if(i){if(this.prev<c.catchLoc)return r(c.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<c.finallyLoc)return r(c.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var c=o?o.completion:{};return c.type=e,c.arg=t,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(c)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var o=r.arg;I(n)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:N(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),b}},t}function o(e,t,n,r,o,a,c){try{var s=e[a](c),i=s.value}catch(e){return void n(e)}s.done?t(i):Promise.resolve(i).then(r,o)}function a(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var c=e.apply(t,n);function s(e){o(c,r,a,s,i,"next",e)}function i(e){o(c,r,a,s,i,"throw",e)}s(void 0)}))}}console.log(t);var c,s,i,u,l,p="https://waitlist.choiceai.in/api/1.1/obj/requests",h="https://waitlist.choiceai.in/api/1.1/obj/custom_tags",f="https://waitlist.choiceai.in/api/1.1/obj/requests",d="https://waitlist.choiceai.in/api/1.1/obj/timestamps",g="https://waitlist.choiceai.in/api/1.1/obj/feedbacks";function m(e){return y.apply(this,arguments)}function y(){return y=a(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Initializing token for user:",t),chrome.cookies.get({url:"https://www.jiocinema.com/",name:"accessToken"},function(){var e=a(r().mark((function e(n){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=n?n.value:null,chrome.cookies.get({url:"https://www.jiocinema.com/",name:"tokenExpiry"},(function(e){i=e?parseInt(e.value):null,s&&i&&i<=Date.now()/1e3+300?b(t):s?console.log("Token found in cookies:",s):(console.log("Token not found in cookies. Generating new token..."),w(t))}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e)}))),y.apply(this,arguments)}function b(e){return v.apply(this,arguments)}function v(){return v=a(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(t);case 3:s=e.sent,console.log("Token refreshed:",s),chrome.cookies.set({url:"https://www.jiocinema.com/",name:"accessToken",value:s,expirationDate:Date.now()/1e3+82800}),chrome.cookies.set({url:"https://www.jiocinema.com/",name:"tokenExpiry",value:(Date.now()/1e3+82800).toString()}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to refresh token:",e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),v.apply(this,arguments)}function w(e){return x.apply(this,arguments)}function x(){return x=a(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k(t);case 3:s=e.sent,console.log("New token generated:",s),chrome.cookies.set({url:"https://www.jiocinema.com/",name:"accessToken",value:s,expirationDate:Date.now()/1e3+86400}),chrome.cookies.set({url:"https://www.jiocinema.com/",name:"tokenExpiry",value:(Date.now()/1e3+86400).toString()}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to generate or save token:",e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),x.apply(this,arguments)}function k(e){return _.apply(this,arguments)}function _(){return _=a(r().mark((function e(t){var n,o,a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,fetch("".concat("http://localhost:5000","/get-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});case 4:if((n=e.sent).ok){e.next=10;break}return e.next=8,n.json();case 8:throw o=e.sent,new Error("Failed to obtain access token: ".concat(o.error||n.statusText));case 10:return e.next=12,n.json();case 12:return a=e.sent,e.abrupt("return",a.access_token);case 16:throw e.prev=16,e.t0=e.catch(1),console.error("Token generation error:",e.t0.message),e.t0;case 20:case"end":return e.stop()}}),e,null,[[1,16]])}))),_.apply(this,arguments)}function T(){return j.apply(this,arguments)}function j(){return(j=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e){chrome.cookies.remove({url:"https://www.jiocinema.com",name:"accessToken"},(function(t){console.log("accessToken cookie removed",t),e()}))}));case 2:return e.next=4,new Promise((function(e){chrome.cookies.remove({url:"https://www.jiocinema.com",name:"tokenExpiry"},(function(t){console.log("tokenExpiry cookie removed",t),e()}))}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,t,n){return O.apply(this,arguments)}function O(){return(O=a(r().mark((function e(t,n,o){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"cheking cookies........."}),a=!1,chrome.cookies.get({url:"https://waitlist.choiceai.in/movie_list",name:"username"},(function(e){0==a&&(e?(a=!0,console.log("loggedInFlag = ".concat(a)),chrome.tabs.sendMessage(n.tab.id,{action:"loggedIn",value:e.value}),c=e.value,console.log("unique_id",c),m(c)):chrome.tabs.sendMessage(n.tab.id,{action:"loggedOut"}))}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e,t,n){return L.apply(this,arguments)}function L(){return L=a(r().mark((function e(t,n,o){var s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:s=!1,chrome.cookies.get({url:"https://waitlist.choiceai.in/movie_list",name:"username"},(function(e){if(0==s)if(e)chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"cookie found by check signup loop........."}),s=!0,chrome.tabs.sendMessage(n.tab.id,{action:"loggedIn",value:e.value}),c=e.value,console.log("unique_id",c),m(c);else{var t=function(){var e=a(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,T();case 2:console.log("User logged out and cookies cleared.");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();t(),chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"signup cookie not found 💀💀💀....."})}}));case 2:case"end":return e.stop()}}),e)}))),L.apply(this,arguments)}function D(e,t,n,r){return I.apply(this,arguments)}function I(){return I=a(r().mark((function e(t,n,o,a){var c,s,i,u,l,h,f,d,g;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:f=function(e){return e.replace(/[!@#$%^&*()_+{}\[\]:;<>,.|?~\\/-]/g,"_")},c=t.title,s=t.url,i=t.type,u=t.platform,l=t.uniqueId,r=s.match(/\/(\d+)$/),h=r?r[1]:"Movie ID not found in the URL.",console.log(h),d=f(c),g={content_name_text:d,platform_text:u,url_text:s,type_text:i,requested_by_text:l,vcode2_text:h},fetch(p,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}).then((function(e){return e.json()})).then((function(e){console.log("Data added successfully:",e),chrome.tabs.sendMessage(n.tab.id,{action:"request_taken",title:d,url:s,type:i})})).catch((function(e){console.error("Error:",e)}));case 11:case"end":return e.stop()}var r}),e)}))),I.apply(this,arguments)}chrome.runtime.onInstalled.addListener((function(e){"install"===e.reason&&chrome.tabs.create({url:"https://waitlist.choiceai.in/"})})),chrome.action.onClicked.addListener((function(e){chrome.scripting.executeScript({target:{tabId:e.id},files:["content.js","youtube.js"]})})),chrome.runtime.onInstalled.addListener((function(){var e;(null===(e=chrome.webNavigation)||void 0===e?void 0:e.onDOMContentLoaded)?chrome.webNavigation.onDOMContentLoaded.addListener(function(){var e=a(r().mark((function e(t){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&t.url&&t.tabId&&t.url.startsWith("https://www.jiocinema.com/"))){e.next=9;break}return e.prev=1,e.next=4,chrome.scripting.executeScript({target:{tabId:t.tabId},func:function(){return console.log("jiocinema.js is executing")}});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(1),console.error("Error executing script:",e.t0);case 9:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t){return e.apply(this,arguments)}}()):console.error("chrome.webNavigation.onDOMContentLoaded is not available")})),chrome.runtime.onInstalled.addListener((function(){chrome.webNavigation&&chrome.webNavigation.onDOMContentLoaded?chrome.webNavigation.onDOMContentLoaded.addListener((function(e){e.url.startsWith("https://www.jiocinema.com/")&&(console.log("JioCinema page loaded"),chrome.scripting.executeScript({target:{tabId:e.tabId},func:function(){console.log("jiocinema.js is executing")}},(function(){console.log("Script executed")})))})):console.error("chrome.webNavigation.onDOMContentLoaded is not available")})),chrome.runtime.onMessage.addListener(function(){var e=a(r().mark((function e(t,n,o){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:e.t0=t.action,e.next="check cookie"===e.t0?3:"check signup"===e.t0?6:"checkTitleExists"===e.t0?9:"createRequest"===e.t0?12:"addCustomTag"===e.t0?15:"addNewTag"===e.t0?18:"AddInExisting"===e.t0?21:"checkrequest"===e.t0?24:"report_error"===e.t0?27:"timestamps"===e.t0?30:"sendFeedback"===e.t0?33:"initialize"===e.t0?36:38;break;case 3:return e.next=5,E(t,n,a);case 5:return e.abrupt("break",38);case 6:return e.next=8,S(t,n,a);case 8:return e.abrupt("break",38);case 9:return e.next=11,Y(t,a,n);case 11:return e.abrupt("break",38);case 12:return e.next=14,D(t,n,a);case 14:return e.abrupt("break",38);case 15:return e.next=17,N(t,n,o);case 17:return e.abrupt("break",38);case 18:return e.next=20,q(t,n,o);case 20:return e.abrupt("break",38);case 21:return e.next=23,C(t,n,o);case 23:return e.abrupt("break",38);case 24:return e.next=26,A(t,n,o);case 26:return e.abrupt("break",38);case 27:return e.next=29,U(t,n,o);case 29:return e.abrupt("break",38);case 30:return e.next=32,G(t,n,o);case 32:return e.abrupt("break",38);case 33:return e.next=35,H(t,n,o);case 35:return e.abrupt("break",38);case 36:m(c=t.email);case 38:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}());var M=0;function N(e,t,n){return P.apply(this,arguments)}function P(){return(P=a(r().mark((function e(t,n,o){var a;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("Request received to add custom tag:",t.data),c=t.uniqueId,console.log("email rcved in backend from custom tag fetch req:",c),a={start_number:t.data.start_number,end_number:t.data.end_number,scenetime_number:t.data.scenetime_number,email_text:c,url_text:t.url,category_text:t.data.category_text,conf_number:t.data.cs},console.log("Request Data to be sent:",a),fetch(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((function(e){return e.json()})).then((function(e){console.log("Data added successfully:",e)})).catch((function(e){console.error("Error:",e)})),o({success:!0});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e,t,n){return R.apply(this,arguments)}function R(){return R=a(r().mark((function e(t,n,o){var a,c,i,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("token in add new tags",s),console.log("Request received to add custom tag:",t.data),a=t.uniqueId,console.log("Email received in backend from custom tag fetch request:",a),c={start_number:t.data.start_number,end_number:t.data.end_number,scenetime_number:t.data.scenetime_number,email_text:a,url_text:t.data.url,category_text:t.data.category_text,title:t.data.title||"",type:t.data.type||"",genres:t.data.genres||[],total_time:t.data.total_time||0,info_status:t.data.info_status||"",poster_url:t.data.poster_url||"",imdb_rating:t.data.imdb_rating||0,conf_number:t.data.cs},console.log("Request Data to be sent:",c),e.prev=6,e.next=9,fetch("http://localhost:5000/api/addingnewtags/untagged",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify(c)});case 9:if((i=e.sent).ok){e.next=12;break}throw new Error("HTTP error! Status: ".concat(i.status));case 12:return e.next=14,i.json();case 14:u=e.sent,console.log("Data added successfully:",u),o({success:!0}),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(6),console.error("Error:",e.t0),o({success:!1,error:e.t0.message});case 23:case"end":return e.stop()}}),e,null,[[6,19]])}))),R.apply(this,arguments)}function C(e,t,n){return F.apply(this,arguments)}function F(){return(F=a(r().mark((function e(t,n,o){var a,c,i,u,l,p,h;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.uniqueId,c=t.data.url,i=t.data.tags,console.log("Email received in backend from custom tag fetch request:",a),console.log("Token in add new tags:",s),c&&Array.isArray(i)&&0!==i.length){e.next=9;break}return console.error("Please enter a URL and add at least one tag."),o({success:!1,error:"Please enter a URL and add at least one tag."}),e.abrupt("return");case 9:return u=i.map((function(e){return{start:e.start_number,end:e.end_number,scenetime:e.scenetime_number,category:e.category_text,confidence:100}})),e.prev=10,e.next=13,fetch("http://localhost:5000/api/addingnewtags/tagged",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(s)},body:JSON.stringify({url:c,newlyAddedTsArray:u})});case 13:if((l=e.sent).ok){e.next=19;break}return e.next=17,l.json();case 17:throw p=e.sent,new Error("HTTP error! Status: ".concat(l.status,", Details: ").concat(JSON.stringify(p)));case 19:return e.next=21,l.json();case 21:h=e.sent,console.log("Tags submitted successfully:",h),o({success:!0,message:"Tags submitted successfully!"}),e.next=30;break;case 26:e.prev=26,e.t0=e.catch(10),console.error("Error:",e.t0),o({success:!1,error:e.t0.message});case 30:case"end":return e.stop()}}),e,null,[[10,26]])})))).apply(this,arguments)}function A(e,t,n){return J.apply(this,arguments)}function J(){return J=a(r().mark((function e(t,n,o){var a,c,s,i,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=t.pageTitle,c=t.currentURL,s=t.uniqueId,i=0,chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"API CHECK REQUEST about to Start.........🔥🔥🔥🔥🔥"}),u=!1,(new Date).getTime(),function e(){chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"CHECk REQUEST API 1 is running....✅"});var t=[{key:"url_text",constraint_type:"text contains",value:c},{key:"requested_by_text",constraint_type:"text contains",value:s}],r="".concat(f,"?constraints=").concat(encodeURIComponent(JSON.stringify(t)),"&cursor=").concat(i);chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"🔗api 1 url =  ".concat(r," ")}),fetch(r).then((function(e){return e.json()})).then((function(t){var r=t.response.results;chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"contentItems ie. response = ".concat(r)}),!u&&r.length>0&&(u=!0,chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"REQUEST Found from API 1 ".concat(a," 🚀")}),chrome.tabs.sendMessage(n.tab.id,{action:"already_requested",pageTitle:a}),(new Date).getTime()),t.response.remaining>0?(i+=100,e()):u||(chrome.tabs.sendMessage(n.tab.id,{action:"checking",mssg:"REQUEST FOR ⚠️: ".concat(a," not found")}),chrome.tabs.sendMessage(n.tab.id,{action:"new_request",pageTitle:a}))})).catch((function(e){console.error("API request error:",e)}))}();case 10:case"end":return e.stop()}}),e)}))),J.apply(this,arguments)}function U(e,t,n){return B.apply(this,arguments)}function B(){return(B=a(r().mark((function e(t,n,o){var a,c,s,i,u,l,p,h,f,d,g,m,y;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Request received to report error:",t),a=t.title,c=t.currentURL,s=t.start,i=t.end,u=t.sceneTime,l=t.category,p=t._id,h={title_text:a,url_text:c,start_text:s,end_text:i,scene_time_text:u,category_text:l,_id:p},f="https://waitlist.choiceai.in/api/1.1/obj/error_reports",d="https://waitlist.choiceai.in/api/1.1/obj/custom_tags/".concat(p),console.log("Starting error reporting process..."),e.prev=12,!p){e.next=24;break}return e.next=16,fetch(d,{method:"DELETE",headers:{"Content-Type":"application/json"}});case 16:if((g=e.sent).ok){e.next=19;break}throw new Error("Failed to delete the record");case 19:return e.t0=console,e.next=22,g.json();case 22:e.t1=e.sent,e.t0.log.call(e.t0,"Record deleted successfully:",e.t1);case 24:return e.next=26,fetch(f,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)});case 26:if((m=e.sent).ok){e.next=29;break}throw new Error("Network response was not ok");case 29:return e.next=31,m.json();case 31:y=e.sent,console.log("Data added successfully:",y),o({success:!0}),e.next=40;break;case 36:e.prev=36,e.t2=e.catch(12),console.error("Error:",e.t2),o({success:!1});case 40:case"end":return e.stop()}}),e,null,[[12,36]])})))).apply(this,arguments)}function G(e,t,n){return z.apply(this,arguments)}function z(){return z=a(r().mark((function t(n,o,a){var c,s,i,l,p,h,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:c=n.data,s=n.opt,(i=n.url).includes("jiocinema")?e="Jio Cinema":i.includes("youtube")&&(e="Youtube"),l=n.categories,console.log("Request received to add timestamps:",c,"opt:",s,"url:",i,"categories:",l,"email:",u),p=function(e){return e.reduce((function(e,t){var n=t.scenetime_text,r=t.category_text;return e[r]||(e[r]=0),e[r]+=n,e}),{})},h=p(c),f=function(e){fetch(d,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){return e.json()})).then((function(e){console.log("Response from API:",e)})).catch((function(e){console.error("API request error:",e)}))},Object.keys(h).forEach((function(t){var n={scenetime_number:h[t],option_text:s,url_text:i,category_text:t,email_text:u,platform_text:e};console.log("Request Data to be sent:",n),f(n)}));case 11:case"end":return t.stop()}}),t)}))),z.apply(this,arguments)}function H(e,t,n){return Q.apply(this,arguments)}function Q(){return(Q=a(r().mark((function e(t,n,o){var a,s;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.feedback,u=c,console.log("Request received to send feedback:",a,", email:",u),o({success:!0}),s={feedback_text:a,email_text:u},fetch(g,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then((function(e){return e.json()})).then((function(e){console.log("Data added successfully:",e),o({success:!0,data:e})})).catch((function(e){console.error("Error:",e),o({success:!1,error:e.message})})),e.abrupt("return",!0);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W=[];function Y(e,t,n){return $.apply(this,arguments)}function $(){return $=a(r().mark((function e(t,o,i){var u,p,h,f,d,g,m,y;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=t.pageTitle,t.platform,p=t.url,c=t.uniqueId,console.log("email rcved in backend from check title exists:",c),f=p.includes("/watch")?p.replace(/\/watch$/,""):p,d=f,console.log("url:",d),d.includes("jiocinema")?h=d.split("/").slice(-1)[0]:d.includes("youtube")?h=d.split("=").slice(-1)[0]:d.includes("primevideo")&&(h=d.split("/").slice(-2,-1)[0]),"http://localhost:5000/api/listOfMovies/getListOfMovies/".concat(h),g="http://localhost:5000/api/timestampData/geteverything/".concat(h),m=(new Date).getTime(),y=function(){var e=a(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:l=d.includes("primevideo")||d.includes("/watch")?d:d+"/watch",console.log("customUrl:",l),console.log("v_code:",h),t=function(){var e=a(r().mark((function e(){var t,o,a,l,p,h,f,d,y;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("secured token :",s),e.next=4,fetch("".concat(g),{headers:{Authorization:"Bearer ".concat(s)}});case 4:return t=e.sent,e.next=7,t.json();case 7:if(o=e.sent,console.log("Data from mongoDB in the fetch request from new db:",o),"Content not found"!==o.message){e.next=28;break}return console.log("timeRanges_DB:",W),chrome.tabs.sendMessage(i.tab.id,{action:"showTitleNotFound",pageTitle:u}),console.log('Title "'.concat(u,'" not found.')),e.next=15,K(i,c);case 15:a=e.sent,console.log("custom tags length const we get:",a.length),console.log("the custom tags we get:",JSON.stringify(a,null,2)),l=function(e){return e&&"object"===n(e)&&e.constructor===Object},p=a.filter((function(e){return l(e)&&"mmm"!==e.category_text})),console.log("validCustomTags:",JSON.stringify(p,null,2)),W=p,console.log("timeRanges_DB after assignment:",JSON.stringify(W,null,2)),console.log("timeRanges_DB.length:",W.length),console.log("timeRanges_DB.length:",W.length),a.length>0?(chrome.tabs.sendMessage(i.tab.id,{action:"customTagsFound",pageTitle:o.title}),W=JSON.stringify(W),console.log("timeRanges_DB in the forrrrr looooppp:",W),chrome.tabs.sendMessage(i.tab.id,{action:"sendTimeRanges_seconds",timeRanges_DB:W})):chrome.tabs.sendMessage(i.tab.id,{action:"customTagsNotFound",pageTitle:o.title}),e.next=45;break;case 28:return console.log("Title Exists...bob"),chrome.tabs.sendMessage(i.tab.id,{action:"showTitlePopup",pageTitle:u}),h=o.ts,W=h.map((function(e){return{start_text:e.start,end_text:e.end,scenetime_text:e.scenetime,category_text:e.category,cs:e.confidence}})),e.next=35,K(i,c);case 35:f=e.sent,W=W.concat(f),console.log("custom tags length const we get",f.length,"the custom tags we get",f),W=JSON.stringify(W),console.log("timeRanges_DB in from msg send :",W),d=(new Date).getTime(),y=d-m,chrome.tabs.sendMessage(i.tab.id,{action:"checking",mssg:"Time taken to Fetch: ".concat(y," ms")}),chrome.tabs.sendMessage(i.tab.id,{action:"sendTimeRanges_seconds",timeRanges_DB:W}),f.length>0?chrome.tabs.sendMessage(i.tab.id,{action:"customTagsFound",pageTitle:o.title}):chrome.tabs.sendMessage(i.tab.id,{action:"customTagsNotFound",pageTitle:o.title});case 45:e.next=50;break;case 47:e.prev=47,e.t0=e.catch(0),console.error("API request error:",e.t0);case 50:case"end":return e.stop()}}),e,null,[[0,47]])})));return function(){return e.apply(this,arguments)}}(),function(){var e=setInterval((function(){s?(clearInterval(e),t()):console.log("Waiting for token...")}),100)}();case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y();case 13:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}chrome.runtime.onMessage.addListener((function(e,t,n){}));var K=function(){var e=a(r().mark((function e(t,n){var o,a,c,s,i,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=[],console.log("unique_id in custom tags fetching",n),e.prev=2,a=[{key:"url_text",constraint_type:"text contains",value:l},{key:"email_text",constraint_type:"equals",value:n}],c="".concat("https://waitlist.choiceai.in/api/1.1/obj/custom_tags","?constraints=").concat(encodeURIComponent(JSON.stringify(a)),"&cursor=").concat(M),console.log("customtags_url:",c),e.next=8,fetch(c);case 8:return s=e.sent,e.next=11,s.json();case 11:if(i=e.sent,u=i.response.results,!(i.response.remaining>0)){e.next=22;break}return M+=100,e.t0=o,e.next=18,K(t,n);case 18:e.t1=e.sent,o=e.t0.concat.call(e.t0,e.t1),e.next=23;break;case 22:u.length>0&&(console.log("Custom tags:",u),u.forEach((function(e){var t=e.start_number,n=e.end_number,r=e.scenetime_number,a=e.category_text,c=e.conf_number,s=e._id;o.push({start_text:t,end_text:n,scenetime_text:r,category_text:a,cs:c,type:"customtags",_id:s})})));case 23:e.next=28;break;case 25:e.prev=25,e.t2=e.catch(2),console.error("API request error:",e.t2);case 28:return e.abrupt("return",o);case 29:case"end":return e.stop()}}),e,null,[[2,25]])})));return function(t,n){return e.apply(this,arguments)}}();chrome.runtime.onMessage.addListener((function(e,t,n){if("new profile"===e.action){var r={username_text:e.email,p_name_text:e.p_name,categories_text:e.cat};fetch("https://waitlist.choiceai.in/api/1.1/obj/profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}).then((function(e){return e.json()})).then((function(e){console.log("Data added successfully:",e)})).catch((function(e){console.error("Error:",e)}))}else if("check profile"===e.action){var o=e.email,a=0,c=!1,s=(new Date).getTime();!function e(){chrome.tabs.sendMessage(t.tab.id,{action:"checking",mssg:"FetchProfile is running....✅"});var n=[{key:"username_text",constraint_type:"text contains",value:o}];chrome.tabs.sendMessage(t.tab.id,{action:"checking",mssg:"Username in cookie constraint is 🔗 = ".concat(o," ")});var r="https://waitlist.choiceai.in/api/1.1/obj/profile?constraints=".concat(encodeURIComponent(JSON.stringify(n)),"&cursor=").concat(a);fetch(r).then((function(e){return e.json()})).then((function(n){var r=n.response.results,i=r.map((function(e){return{profileName:e.p_name_text,categories:e.categories_text.split(", ")}}));if(console.log("Profile Data:",i),console.log("Length of contentItems:",r.length),!c&&r.length>0){console.log("Username Profile Exists...");var u=i.map((function(e){return"".concat(e.profileName,": ").concat(e.categories.join(", "))})).join("; ");chrome.tabs.sendMessage(t.tab.id,{action:"loadProfiles",profile:u}),c=!0;var l=(new Date).getTime()-s;chrome.tabs.sendMessage(t.tab.id,{action:"checking",mssg:"Time taken to Fetch User Profile: ".concat(l," ms")})}n.response.remaining>0?(a+=100,e()):c||chrome.tabs.sendMessage(t.tab.id,{action:"checking",mssg:"Profile⚠️: ".concat(o)})})).catch((function(e){console.error("API request error:",e),chrome.tabs.sendMessage(t.tab.id,{action:"checking",mssg:"API request error: ".concat(e)})}))}()}}))})();